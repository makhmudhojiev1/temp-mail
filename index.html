<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self' https://www.guerrillamail.com https://api.guerrillamail.com https://cdnjs.cloudflare.com ws://127.0.0.1:* wss://127.0.0.1:*; connect-src 'self' https://www.guerrillamail.com https://api.guerrillamail.com ws://127.0.0.1:* wss://127.0.0.1:*; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; script-src 'self' 'unsafe-inline' 'unsafe-eval'; font-src https://cdnjs.cloudflare.com; img-src 'self' data: https:; media-src 'self' https:;"
    />
    <title>TempMail - Disposable Email Service</title>
    <meta
      name="description"
      content="Create temporary email addresses with TempMail to protect your inbox from spam and unwanted emails. Fast, secure, and easy-to-use disposable email service."
    />
    <meta
      name="keywords"
      content="temporary email, disposable email, temp mail, spam protection, secure email"
    />
    <meta name="author" content="Mehmet Kahya" />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="TempMail - Disposable Email Service" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Fast and secure temporary email service." />
    <meta property="og:url" content="https://tempmail.example.com" />
    <meta property="og:image" content="https://tempmail.example.com/images/og-image.png" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="TempMail - Disposable Email Service" />
    <meta name="twitter:description" content="Fast and secure temporary email service." />
    <meta name="twitter:image" content="https://tempmail.example.com/images/twitter-image.png" />

    <!-- External Libraries -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="icon" href="images/temp-mail-icon.png" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Embedded CSS -->
    <style>
      :root {
        --primary-color: #3b82f6;
        --secondary-color: #10b981;
        --danger-color: #ef4444;
        --bg-light: #f9fafb;
        --bg-dark: #1f2937;
        --text-light: #111827;
        --text-dark: #d1d5db;
        --border-color: #e5e7eb;
        --card-bg: #ffffff;
        --card-bg-dark: #374151;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-light);
        color: var(--text-light);
        line-height: 1.6;
        transition: all 0.3s ease;
      }

      body.dark {
        background: var(--bg-dark);
        color: var(--text-dark);
      }

      .app-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        padding: 20px;
        background: linear-gradient(135deg, #3b82f6, #10b981);
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .header-content {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .ascii-art {
        font-family: monospace;
        font-size: 2rem;
        color: #ffffff;
        letter-spacing: 2px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .ascii-art pre {
        margin: 0;
      }

      .system-status {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 10px;
        font-size: 0.9rem;
        color: #ffffff;
      }

      .status-led {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      }

      .status-led.online { background: var(--secondary-color); }
      .status-led.offline { background: var(--danger-color); }

      .theme-switch {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background: var(--primary-color);
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      .poll {
        text-align: center;
        padding: 20px;
        background: #f3f4f6;
        border-radius: 10px;
        margin: 20px 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      body.dark .poll {
        background: #4b5563;
      }

      .star-rating {
        margin: 10px 0;
      }

      .star-rating .fa-star {
        cursor: pointer;
        color: #d1d5db;
        font-size: 1.5rem;
        transition: color 0.2s ease;
      }

      .star-rating .fa-star.checked {
        color: #facc15;
      }

      .card {
        background: var(--card-bg);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
      }

      body.dark .card {
        background: var(--card-bg-dark);
        border-color: #4b5563;
      }

      .email-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
      }

      .email-input-group {
        flex: 1;
        position: relative;
        min-width: 300px;
      }

      .email-input-group input {
        width: 100%;
        padding: 10px 40px;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        font-size: 1rem;
        background: #f9fafb;
        color: var(--text-light);
      }

      body.dark .email-input-group input {
        background: #2d3748;
        color: var(--text-dark);
        border-color: #4b5563;
      }

      .input-icon {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
      }

      .email-input-group .icon-button {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 5px;
      }

      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .primary-button, .danger-button, .icon-button {
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.9rem;
      }

      .primary-button {
        background: var(--primary-color);
        color: #fff;
      }

      .primary-button:hover {
        background: #2563eb;
      }

      .danger-button {
        background: var(--danger-color);
        color: #fff;
      }

      .danger-button:hover {
        background: #dc2626;
      }

      .icon-button {
        background: #e5e7eb;
        padding: 8px;
      }

      .icon-button:hover {
        background: #d1d5db;
      }

      .auto-refresh {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .checkbox-label {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.9rem;
      }

      .select-input {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid var(--border-color);
        background: #f9fafb;
        color: var(--text-light);
      }

      body.dark .select-input {
        background: #2d3748;
        color: var(--text-dark);
        border-color: #4b5563;
      }

      .search-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .search-input-group {
        position: relative;
        flex: 1;
        min-width: 200px;
      }

      .search-input-group input {
        width: 100%;
        padding: 10px 40px;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        font-size: 1rem;
        background: #f9fafb;
        color: var(--text-light);
      }

      body.dark .search-input-group input {
        background: #2d3748;
        color: var(--text-dark);
        border-color: #4b5563;
      }

      .search-input-group .fa-magnifying-glass {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
      }

      .search-input-group .icon-button {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 5px;
      }

      .email-stats {
        font-size: 0.9rem;
        color: #6b7280;
        white-space: nowrap;
      }

      .no-emails-message {
        text-align: center;
        padding: 40px 20px;
        color: #6b7280;
        font-size: 1.1rem;
      }

      .no-emails-message i {
        font-size: 2rem;
        margin-bottom: 10px;
        color: #9ca3af;
      }

      .table-container {
        overflow-x: auto;
        margin-top: 20px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: #f9fafb;
      }

      body.dark table {
        background: #2d3748;
      }

      th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        background: #e5e7eb;
        font-weight: 600;
        color: #374151;
      }

      body.dark th {
        background: #4b5563;
        color: #d1d5db;
      }

      td {
        color: var(--text-light);
      }

      body.dark td {
        color: var(--text-dark);
      }

      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-top: 20px;
        font-size: 0.9rem;
      }

      .footer {
        text-align: center;
        padding: 20px;
        border-top: 1px solid var(--border-color);
        margin-top: 40px;
        font-size: 0.9rem;
      }

      .footer-links a {
        margin: 0 10px;
        color: var(--primary-color);
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .footer-links a:hover {
        color: #2563eb;
        text-decoration: underline;
      }

      .welcome-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--card-bg);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        max-width: 400px;
        opacity: 0;
        transition: opacity 0.3s ease;
        border: 1px solid var(--border-color);
      }

      body.dark .welcome-message {
        background: var(--card-bg-dark);
        border-color: #4b5563;
      }

      .welcome-message.show {
        opacity: 1;
      }

      .welcome-message-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
      }

      .welcome-message-header i {
        color: var(--primary-color);
        font-size: 1.5rem;
      }

      .welcome-message-content ul {
        margin: 10px 0;
        padding-left: 20px;
      }

      .welcome-message-actions {
        text-align: center;
        margin-top: 20px;
      }

      @keyframes slideOut {
        from { transform: translate(-50%, -50%); opacity: 1; }
        to { transform: translate(-50%, -70%); opacity: 0; }
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 10px;
        max-width: 600px;
        width: 90%;
        position: relative;
        border: 1px solid var(--border-color);
        max-height: 80vh;
        overflow-y: auto;
      }

      body.dark .modal-content {
        background: var(--card-bg-dark);
        border-color: #4b5563;
      }

      .close-modal {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
      }

      .close-modal:hover {
        color: var(--danger-color);
      }

      .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        border-radius: 5px;
        color: #fff;
        font-size: 0.9rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
      }

      .notification.success { background: var(--secondary-color); }
      .notification.error { background: var(--danger-color); }

      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }

      @keyframes fadeOut {
        to { opacity: 0; }
      }

      /* Attachment Preview Styles */
      .attachment-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
      }

      .attachment-section h4 {
        margin-bottom: 10px;
        font-size: 1.1rem;
        color: var(--text-light);
      }

      body.dark .attachment-section h4 {
        color: var(--text-dark);
      }

      .attachment-list {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
      }

      .attachment-item {
        max-width: 200px;
        text-align: center;
      }

      .attachment-preview img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .attachment-preview video {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .attachment-info {
        margin-top: 5px;
        font-size: 0.9rem;
        color: #6b7280;
      }

      .attachment-download {
        display: inline-block;
        margin-top: 5px;
        padding: 5px 10px;
        background: var(--primary-color);
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
        font-size: 0.9rem;
        transition: background 0.3s ease;
      }

      .attachment-download:hover {
        background: #2563eb;
      }
    </style>
  </head>

  <body>
    <div class="app-container">
      <!-- Theme Switcher -->
      <div class="theme-switch">
        <i class="fa-solid fa-moon"></i>
        <label class="switch">
          <input type="checkbox" id="theme-toggle" aria-label="Toggle dark/light theme" />
          <span class="slider round"></span>
        </label>
        <i class="fa-solid fa-sun"></i>
      </div>

      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <div class="ascii-art">
            <pre>
TEMP MAIL
            </pre>
          </div>
          <div class="system-status">
            <div id="status-led" class="status-led offline"></div>
            <span id="status-text">Offline</span>
          </div>
        </div>
      </header>

      <!-- Poll Section -->
      <section class="poll">
        <p>How do you like the new UI?</p>
        <div class="star-rating" role="radiogroup" aria-label="Rate the UI">
          <i class="fa-solid fa-star" data-value="1" role="radio" aria-checked="false"></i>
          <i class="fa-solid fa-star" data-value="2" role="radio" aria-checked="false"></i>
          <i class="fa-solid fa-star" data-value="3" role="radio" aria-checked="false"></i>
          <i class="fa-solid fa-star" data-value="4" role="radio" aria-checked="false"></i>
          <i class="fa-solid fa-star" data-value="5" role="radio" aria-checked="false"></i>
        </div>
        <button onclick="submitPoll()" class="primary-button">Submit Feedback</button>
      </section>

      <!-- Main Content -->
      <main class="main-content">
        <div class="card email-card">
          <div class="email-controls">
            <div class="email-input-group">
              <i class="fa-solid fa-at input-icon"></i>
              <input id="addr" placeholder="Your temporary email" readonly aria-label="Temporary email address" />
              <button onclick="copyEmail()" class="icon-button" aria-label="Copy email">
                <i class="fa-solid fa-copy"></i>
              </button>
              <button onclick="downloadEmails()" class="icon-button" aria-label="Download all emails">
                <i class="fa-solid fa-download"></i>
              </button>
              <button onclick="shareEmail()" class="icon-button" aria-label="Share email">
                <i class="fa-solid fa-share"></i>
              </button>
            </div>
            <div class="button-group">
              <button onclick="refreshMail()" class="primary-button">
                <i class="fa-solid fa-rotate"></i> Refresh Inbox
              </button>
              <button onclick="genEmail()" class="primary-button">
                <i class="fa-solid fa-wand-magic-sparkles"></i> New Address
              </button>
              <button onclick="clearInbox()" class="danger-button">
                <i class="fa-solid fa-trash"></i> Clear Inbox
              </button>
            </div>
            <div class="auto-refresh">
              <label class="checkbox-label">
                <i class="fa-solid fa-arrows-rotate"></i>
                <input type="checkbox" id="auto-refresh" aria-label="Enable auto-refresh" />
                <span>Auto Refresh</span>
              </label>
              <select id="refresh-interval" class="select-input" aria-label="Refresh interval">
                <option value="5">5s</option>
                <option value="10">10s</option>
                <option value="30">30s</option>
                <option value="60">1m</option>
                <option value="300">5m</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card inbox-card">
          <div class="search-container">
            <div class="search-input-group">
              <i class="fa-solid fa-magnifying-glass"></i>
              <input
                type="text"
                id="email-search"
                placeholder="Search emails..."
                onkeyup="searchEmails()"
                aria-label="Search emails"
              />
              <button onclick="clearSearch()" class="icon-button" aria-label="Clear search">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>
            <div class="email-stats">
              <span id="email-count">0 emails</span>
              <span id="storage-used">0.00MB used</span>
            </div>
          </div>

          <div id="no-emails" class="no-emails-message">
            <i class="fa-solid fa-inbox"></i>
            <p>Your inbox is empty. Generate a new email address to start receiving messages.</p>
          </div>

          <div class="table-container">
            <table id="emails" aria-label="Email inbox">
              <thead>
                <tr>
                  <th scope="col"><i class="fa-solid fa-hashtag"></i> ID</th>
                  <th scope="col"><i class="fa-solid fa-user"></i> From</th>
                  <th scope="col"><i class="fa-solid fa-envelope"></i> Subject</th>
                  <th scope="col"><i class="fa-solid fa-calendar"></i> Date</th>
                  <th scope="col"><i class="fa-solid fa-gear"></i> Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="pagination">
            <button onclick="previousPage()" class="icon-button" disabled id="prev-page" aria-label="Previous page">
              <i class="fa-solid fa-chevron-left"></i>
            </button>
            <span id="page-info" aria-live="polite">Page 1 of 1</span>
            <button onclick="nextPage()" class="icon-button" disabled id="next-page" aria-label="Next page">
              <i class="fa-solid fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <div class="footer-content">
          <div class="footer-links">
            <a href="#" onclick="showAbout()" aria-label="About TempMail">About</a>
            <a href="#" onclick="showPrivacy()" aria-label="Privacy Policy">Privacy</a>
            <a href="#" onclick="showTerms()" aria-label="Terms of Service">Terms</a>
            <a href="#" onclick="showContact()" aria-label="Contact Us">Contact</a>
          </div>
          <div class="footer-info">
            <p>© 2025 TempMail. All rights reserved.</p>
            <p id="version-info">Version 2.1.1</p>
          </div>
        </div>
      </footer>
    </div>

    <!-- Welcome Message -->
    <div id="welcomeMessage" class="welcome-message" role="dialog" aria-labelledby="welcome-title">
      <div class="welcome-message-header">
        <i class="fas fa-info-circle"></i>
        <h3 id="welcome-title">Welcome to TempMail</h3>
      </div>
      <div class="welcome-message-content">
        <p><strong>Troubleshooting Tips:</strong></p>
        <ul>
          <li>If you see a "failed to load" error, click "New Address" multiple times.</li>
          <li>For persistent issues, reach out via GitHub or LinkedIn.</li>
        </ul>
        <p>Thank you for using TempMail! ❤️</p>
      </div>
      <div class="welcome-message-actions">
        <button onclick="hideWelcomeMessage()" class="primary-button" aria-label="Close welcome message">Got it!</button>
      </div>
    </div>

    <!-- Modal Dialog -->
    <div id="modal" class="modal" role="dialog" aria-labelledby="modal-title">
      <div class="modal-content">
        <span class="close-modal" onclick="closeModal()" aria-label="Close modal">×</span>
        <h2 id="modal-title">Modal Title</h2>
        <div id="modal-body">
          <p>Modal content goes here.</p>
        </div>
      </div>
    </div>

    <!-- Embedded JavaScript -->
    <script>
      // Global Variables
      let selectedRating = 0;
      let currentPage = 1;
      const emailsPerPage = 10;
      let allEmails = [];
      let autoRefreshInterval = null;
      let emailSession = null; // Guerrilla Mail session data

      // Simulated attachment data for testing (since Guerrilla Mail API doesn't provide attachments)
      const sampleAttachments = [
        {
          id: "1",
          attachments: [
            { name: "image1.jpg", url: "https://picsum.photos/200/300", type: "image/jpeg" },
            { name: "video1.mp4", url: "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4", type: "video/mp4" },
            { name: "document.pdf", url: "https://sample-videos.com/pdf/Sample-pdf-file.pdf", type: "application/pdf" }
          ]
        },
        {
          id: "2",
          attachments: [
            { name: "image2.png", url: "https://picsum.photos/200/200", type: "image/png" }
          ]
        }
      ];

      // Initial Setup
      document.addEventListener("DOMContentLoaded", () => {
        initializeApp();
        setupEventListeners();
        genEmail(); // Generate email on load
      });

      function initializeApp() {
        if (!localStorage.getItem("warningShown")) {
          showWarning();
          localStorage.setItem("warningShown", "true");
        }
        if (!localStorage.getItem("welcomeMessageSeen")) {
          setTimeout(() => document.getElementById("welcomeMessage").classList.add("show"), 1000);
        } else {
          document.getElementById("welcomeMessage").remove();
        }
        updateEmailStats();
      }

      function setupEventListeners() {
        // Star Rating
        document.querySelectorAll(".star-rating .fa-star").forEach(star => {
          star.addEventListener("click", () => {
            selectedRating = parseInt(star.getAttribute("data-value"));
            highlightStars(selectedRating);
            star.setAttribute("aria-checked", "true");
          });
          star.addEventListener("mouseover", () => highlightStars(parseInt(star.getAttribute("data-value"))));
          star.addEventListener("mouseout", () => highlightStars(selectedRating));
        });

        // Auto Refresh
        document.getElementById("auto-refresh").addEventListener("change", toggleAutoRefresh);
        document.getElementById("refresh-interval").addEventListener("change", updateAutoRefreshInterval);

        // Modal Close on Outside Click
        window.addEventListener("click", event => {
          const modal = document.getElementById("modal");
          if (event.target === modal) closeModal();
        });

        // Theme Toggle
        document.getElementById("theme-toggle").addEventListener("change", () => {
          document.body.classList.toggle("dark");
          localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
        });

        // Load Theme Preference
        if (localStorage.getItem("theme") === "dark") {
          document.body.classList.add("dark");
          document.getElementById("theme-toggle").checked = true;
        }
      }

      // Warning
      function showWarning() {
        alert(
          "⚠️ TempMail is for educational purposes only. Illegal activities are prohibited, and we are not liable for misuse. This service uses Guerrilla Mail's API. Use responsibly. ⚠️"
        );
      }

      // Star Rating
      function highlightStars(rating) {
        document.querySelectorAll(".star-rating .fa-star").forEach(star => {
          star.classList.toggle("checked", parseInt(star.getAttribute("data-value")) <= rating);
        });
      }

      function submitPoll() {
        if (selectedRating === 0) return alert("Please select a rating.");
        fetch("https://your-api-endpoint.com/feedback", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ rating: selectedRating, timestamp: new Date().toISOString() })
        })
          .then(() => {
            alert("Thank you for your feedback!");
            document.querySelector(".poll").style.display = "none";
            localStorage.setItem("pollSubmitted", "true");
          })
          .catch(() => alert("Failed to submit feedback. Please try again."));
      }

      // Guerrilla Mail Integration
      async function genEmail() {
        try {
          // Get a new email address from Guerrilla Mail
          const response = await fetch("https://api.guerrillamail.com/ajax.php?f=get_email_address");
          const data = await response.json();
          if (data.email_addr) {
            emailSession = data;
            document.getElementById("addr").value = data.email_addr;
            document.getElementById("status-led").classList.remove("offline");
            document.getElementById("status-led").classList.add("online");
            document.getElementById("status-text").textContent = "Online";
            showNotification("New email address generated!");
            refreshMail(); // Fetch emails for the new address
          } else {
            throw new Error("Failed to generate email address");
          }
        } catch (error) {
          console.error("Error generating email:", error);
          showNotification("Failed to generate email. Please try again.", "error");
        }
      }

      async function refreshMail() {
        if (!emailSession) {
          showNotification("No email session. Generate a new address first.", "error");
          return;
        }
        try {
          // Fetch email list using Guerrilla Mail API
          const response = await fetch(`https://api.guerrillamail.com/ajax.php?f=check_email&seq=0&sid_token=${emailSession.sid_token}`);
          const data = await response.json();
          if (data.list && data.list.length > 0) {
            allEmails = data.list.map(email => {
              // Simulate attachments for testing
              const attachmentData = sampleAttachments.find(att => att.id === email.mail_id);
              return {
                id: email.mail_id,
                from: email.mail_from,
                subject: email.mail_subject,
                date: new Date(email.mail_timestamp * 1000).toLocaleString(),
                body: email.mail_excerpt,
                attachments: attachmentData ? attachmentData.attachments : []
              };
            });
          } else {
            allEmails = [];
          }
          displayEmails(allEmails);
          updateEmailStats();
          showNotification("Inbox refreshed!");
        } catch (error) {
          console.error("Error refreshing inbox:", error);
          showNotification("Failed to refresh inbox. Please try again.", "error");
        }
      }

      // Email Functions
      function copyEmail() {
        const email = document.getElementById("addr").value;
        navigator.clipboard.writeText(email).then(() => {
          showNotification("Email copied to clipboard!");
        });
      }

      function shareEmail() {
        const email = document.getElementById("addr").value;
        if (navigator.share) {
          navigator.share({
            title: "TempMail Address",
            text: `Use this temporary email: ${email}`,
            url: window.location.href
          }).catch(() => showNotification("Sharing failed.", "error"));
        } else {
          copyEmail();
          showNotification("Share not supported. Email copied instead!");
        }
      }

      function searchEmails() {
        const searchTerm = document.getElementById("email-search").value.toLowerCase();
        const filteredEmails = allEmails.filter(email =>
          email.from.toLowerCase().includes(searchTerm) || email.subject.toLowerCase().includes(searchTerm)
        );
        currentPage = 1; // Reset to first page on search
        displayEmails(filteredEmails);
      }

      function clearSearch() {
        document.getElementById("email-search").value = "";
        displayEmails(allEmails);
      }

      function downloadEmails() {
        if (!allEmails.length) return showNotification("No emails to download.", "error");
        const emailData = JSON.stringify(allEmails, null, 2);
        const blob = new Blob([emailData], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `tempmail_emails_${new Date().toISOString().replace(/[:.]/g, "-")}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showNotification("Emails downloaded successfully!");
      }

      function clearInbox() {
        if (!confirm("Clear inbox? This action cannot be undone.")) return;
        allEmails = [];
        displayEmails(allEmails);
        updateEmailStats();
        showNotification("Inbox cleared!");
      }

      // Auto Refresh
      function toggleAutoRefresh() {
        const checkbox = document.getElementById("auto-refresh");
        if (checkbox.checked) {
          const interval = document.getElementById("refresh-interval").value * 1000;
          autoRefreshInterval = setInterval(refreshMail, interval);
          showNotification("Auto-refresh enabled!");
        } else {
          clearInterval(autoRefreshInterval);
          showNotification("Auto-refresh disabled!");
        }
      }

      function updateAutoRefreshInterval() {
        if (document.getElementById("auto-refresh").checked) {
          clearInterval(autoRefreshInterval);
          const interval = document.getElementById("refresh-interval").value * 1000;
          autoRefreshInterval = setInterval(refreshMail, interval);
          showNotification(`Refresh interval updated to ${interval / 1000}s`);
        }
      }

      // Stats and Pagination
      function updateEmailStats() {
        document.getElementById("email-count").textContent = `${allEmails.length} emails`;
        const size = JSON.stringify(allEmails).length;
        const sizeInMB = (size / (1024 * 1024)).toFixed(2);
        document.getElementById("storage-used").textContent = `${sizeInMB}MB used`;
      }

      function displayEmails(emails) {
        const startIdx = (currentPage - 1) * emailsPerPage;
        const paginatedEmails = emails.slice(startIdx, startIdx + emailsPerPage);
        const tbody = document.querySelector("#emails tbody");
        tbody.innerHTML = paginatedEmails.length
          ? paginatedEmails.map(email => `
              <tr>
                <td>${email.id || "N/A"}</td>
                <td>${email.from || "Unknown"}</td>
                <td>${email.subject || "No Subject"}</td>
                <td>${email.date || "N/A"}</td>
                <td>
                  <button onclick="viewEmail('${email.id}')" class="icon-button" aria-label="View email">
                    <i class="fa-solid fa-eye"></i>
                  </button>
                  <button onclick="deleteEmail('${email.id}')" class="icon-button" aria-label="Delete email">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </td>
              </tr>`).join("")
          : "";
        document.getElementById("no-emails").style.display = emails.length ? "none" : "block";
        updatePagination(emails.length);
      }

      function updatePagination(totalEmails) {
        const totalPages = Math.ceil(totalEmails / emailsPerPage) || 1;
        document.getElementById("page-info").textContent = `Page ${currentPage} of ${totalPages}`;
        document.getElementById("prev-page").disabled = currentPage === 1;
        document.getElementById("next-page").disabled = currentPage === totalPages;
      }

      function nextPage() {
        if (currentPage < Math.ceil(allEmails.length / emailsPerPage)) {
          currentPage++;
          displayEmails(allEmails);
        }
      }

      function previousPage() {
        if (currentPage > 1) {
          currentPage--;
          displayEmails(allEmails);
        }
      }

      // Attachment Preview Function
      function renderAttachments(attachments) {
        if (!attachments || attachments.length === 0) return "";
        return `
          <div class="attachment-section">
            <h4>Attachments</h4>
            <div class="attachment-list">
              ${attachments.map(att => {
                if (att.type.startsWith("image/")) {
                  return `
                    <div class="attachment-item">
                      <div class="attachment-preview">
                        <img src="${att.url}" alt="${att.name}" />
                      </div>
                      <div class="attachment-info">${att.name}</div>
                      <a href="${att.url}" download class="attachment-download">Download</a>
                    </div>`;
                } else if (att.type.startsWith("video/")) {
                  return `
                    <div class="attachment-item">
                      <div class="attachment-preview">
                        <video controls>
                          <source src="${att.url}" type="${att.type}">
                          Your browser does not support the video tag.
                        </video>
                      </div>
                      <div class="attachment-info">${att.name}</div>
                      <a href="${att.url}" download class="attachment-download">Download</a>
                    </div>`;
                } else {
                  return `
                    <div class="attachment-item">
                      <div class="attachment-info">${att.name}</div>
                      <a href="${att.url}" download class="attachment-download">Download</a>
                    </div>`;
                }
              }).join("")}
            </div>
          </div>`;
      }

      // Email View with Attachments
      async function viewEmail(id) {
        const email = allEmails.find(e => e.id === id);
        if (email) {
          try {
            // Fetch email details using Guerrilla Mail API
            const response = await fetch(`https://api.guerrillamail.com/ajax.php?f=fetch_email&email_id=${id}&sid_token=${emailSession.sid_token}`);
            const data = await response.json();
            if (data.mail_body) {
              email.body = data.mail_body;
            }
            const attachmentHtml = renderAttachments(email.attachments);
            showModal("Email Details", `
              <p><strong>From:</strong> ${email.from}</p>
              <p><strong>Subject:</strong> ${email.subject}</p>
              <p><strong>Date:</strong> ${email.date}</p>
              <p><strong>Body:</strong> ${email.body || "No content available"}</p>
              ${attachmentHtml}
            `);
          } catch (error) {
            console.error("Error fetching email details:", error);
            showNotification("Failed to load email details.", "error");
          }
        }
      }

      async function deleteEmail(id) {
        if (!confirm("Delete this email?")) return;
        try {
          // Delete email using Guerrilla Mail API
          await fetch(`https://api.guerrillamail.com/ajax.php?f=del_email&email_ids[]=${id}&sid_token=${emailSession.sid_token}`);
          allEmails = allEmails.filter(e => e.id !== id);
          displayEmails(allEmails);
          updateEmailStats();
          showNotification("Email deleted!");
        } catch (error) {
          console.error("Error deleting email:", error);
          showNotification("Failed to delete email.", "error");
        }
      }

      function showNotification(message, type = "success") {
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
      }

      // Modal Functions
      function showModal(title, content) {
        document.getElementById("modal-title").textContent = title;
        document.getElementById("modal-body").innerHTML = content;
        document.getElementById("modal").style.display = "flex";
      }

      function closeModal() {
        document.getElementById("modal").style.display = "none";
      }

      function showAbout() {
        showModal("About TempMail", `
          <h3>About TempMail</h3>
          <p>A free disposable email service created by Mehmet Kahya.</p>
          <p>Version: 2.1.1</p>
          <p>Protect your inbox with ease using Guerrilla Mail's API.</p>
        `);
      }

      function showPrivacy() {
        showModal("Privacy Policy", `
          <h3>Privacy Policy</h3>
          <p>Your privacy matters. Emails are deleted automatically after a set period.</p>
          <p>No personal data is stored beyond session use.</p>
        `);
      }

      function showTerms() {
        showModal("Terms of Service", `
          <h3>Terms of Service</h3>
          <ul>
            <li>Use for legitimate purposes only.</li>
            <li>Illegal activities are strictly prohibited.</li>
            <li>Service provided "as is" without warranties.</li>
          </ul>
        `);
      }

      function showContact() {
        showModal("Contact Us", `
          <h3>Contact Us</h3>
          <p>Questions or feedback?</p>
          <ul>
            <li>Email: contact@tempmail.example</li>
            <li>GitHub: github.com/mehmetkahya</li>
            <li>LinkedIn: linkedin.com/in/mehmetkahya</li>
          </ul>
        `);
      }

      // Welcome Message
      function hideWelcomeMessage() {
        const welcomeMessage = document.getElementById("welcomeMessage");
        welcomeMessage.style.animation = "slideOut 0.5s ease forwards";
        confetti({
          particleCount: 150,
          spread: 180,
          origin: { y: 0.8 },
          colors: ["#3B82F6", "#60A5FA", "#2563EB", "#10B981", "#34D399"]
        });
        setTimeout(() => {
          welcomeMessage.remove();
          localStorage.setItem("welcomeMessageSeen", "true");
        }, 500);
      }
    </script>
  </body>
</html>
